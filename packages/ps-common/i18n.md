# @sdppp/common i18n å›½é™…åŒ–ç³»ç»Ÿ

## æ¦‚è¿°

æœ¬æ–‡æ¡£è®°å½•äº† SDPPP é¡¹ç›®ä¸­ç»Ÿä¸€çš„å›½é™…åŒ–ï¼ˆi18nï¼‰ç³»ç»Ÿçš„æ¶æ„è®¾è®¡å’Œä½¿ç”¨æ–¹æ³•ã€‚è¯¥ç³»ç»Ÿäº 2024-08-31 å®Œæˆé‡æ„ï¼Œé‡‡ç”¨åŸºäºæŠ€æœ¯æ ˆçš„åˆ†å±‚æ¶æ„è®¾è®¡ã€‚

## é‡æ„å†ç¨‹

### é‡æ„å‰çš„é—®é¢˜
- å¤šä¸ª i18n æ–‡ä»¶æ•£å¸ƒåœ¨ä¸åŒä½ç½®ï¼ˆ`i18n.ts`, `i18n_next.ts`, `i18n_uxp.ts`, `i18n_antd.ts`, `i18n_utils.ts`ï¼‰
- ç¿»è¯‘èµ„æºæ ¼å¼ä¸ç»Ÿä¸€ï¼ˆJSON + TypeScript å¯¹è±¡æ··ç”¨ï¼‰
- æŒ‰è¿è¡Œç¯å¢ƒåŒºåˆ† APIï¼ˆUXP vs éUXPï¼‰ï¼Œå¯¼è‡´æ¦‚å¿µæ··ä¹±
- ç¼ºä¹ç±»å‹å®‰å…¨ä¿éšœ
- ä¾èµ–å…³ç³»å¤æ‚ï¼Œç»´æŠ¤å›°éš¾

### é‡æ„åçš„æ”¹è¿›
- **ç»Ÿä¸€æ¶æ„**ï¼šæŒ‰æŠ€æœ¯æ ˆåˆ†å±‚ï¼ˆReact vs Vanilla JavaScriptï¼‰
- **ç±»å‹å®‰å…¨**ï¼šå…¨éƒ¨è¿ç§»åˆ° TypeScriptï¼Œæä¾›å®Œæ•´çš„ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
- **ç»Ÿä¸€èµ„æº**ï¼šæ‰€æœ‰ç¯å¢ƒå…±äº«åŒä¸€å¥—ç¿»è¯‘é”®å€¼å’Œèµ„æºæ–‡ä»¶
- **æ¸…æ™°åˆ†å·¥**ï¼šReact ç¯å¢ƒä½¿ç”¨ react-i18nextï¼Œçº¯ JS ç¯å¢ƒä½¿ç”¨è½»é‡çº§å®ç°
- **å‘åå…¼å®¹**ï¼šä¿ç•™å¸¸ç”¨ API çš„åˆ«åå¯¼å‡º

## æ–°æ¶æ„è®¾è®¡

```
@sdppp/common/i18n/
â”œâ”€â”€ locales/
â”‚   â”œâ”€â”€ zh-CN.ts          # ä¸­æ–‡ç¿»è¯‘èµ„æº (TypeScript)
â”‚   â”œâ”€â”€ en-US.ts          # è‹±æ–‡ç¿»è¯‘èµ„æº (TypeScript) 
â”‚   â””â”€â”€ index.ts          # ç±»å‹å®šä¹‰å’Œèµ„æºå¯¼å‡º
â”œâ”€â”€ vanilla.ts            # çº¯ JavaScript ç¯å¢ƒçš„ i18n API
â”œâ”€â”€ react.ts              # React ç¯å¢ƒçš„ i18n API (åŸºäº react-i18next)
â””â”€â”€ index.ts              # ç»Ÿä¸€å…¥å£å’Œå‘åå…¼å®¹æ€§å¯¼å‡º
```

## ä½¿ç”¨æ–¹æ³•

### åœ¨çº¯ JavaScript ç¯å¢ƒä¸­ä½¿ç”¨ï¼ˆæ¨èç”¨äº UXP æ’ä»¶ï¼‰

```typescript
import { t } from '@sdppp/common/i18n/vanilla'

// åŸºæœ¬ç”¨æ³•
const loginText = t('auth.login_success')  // "ç™»å½•æˆåŠŸ" æˆ– "Login Successful"

// å¸¦å‚æ•°çš„ç¿»è¯‘
const userText = t('auth.username_label', { username: 'John' })  // "ç”¨æˆ·å: John"

// è·å–å½“å‰è¯­è¨€
import { getCurrentLanguage, isZhCN } from '@sdppp/common/i18n/vanilla'
console.log(getCurrentLanguage())  // "zh-CN" æˆ– "en-US"
console.log(isZhCN())  // true æˆ– false

// æ‰‹åŠ¨åˆ‡æ¢è¯­è¨€
import { changeLanguage } from '@sdppp/common/i18n/vanilla'
changeLanguage('en-US')
```

### åœ¨ React ç»„ä»¶ä¸­ä½¿ç”¨

```typescript
import { useTranslation } from '@sdppp/common/i18n/react'

function MyComponent() {
  const { t, changeLanguage, language, isZhCN } = useTranslation()
  
  return (
    <div>
      <h1>{t('auth.login_success')}</h1>
      <p>{t('auth.username_label', { username: 'John' })}</p>
      <button onClick={() => changeLanguage('en-US')}>
        Switch to English
      </button>
      <p>Current language: {language}</p>
    </div>
  )
}
```

### åœ¨éç»„ä»¶ React ç¯å¢ƒä¸­ä½¿ç”¨

```typescript
import { t, changeLanguage, getCurrentLanguage } from '@sdppp/common/i18n/react'

// åœ¨å·¥å…·å‡½æ•°ã€ä¸­é—´ä»¶ç­‰åœ°æ–¹ä½¿ç”¨
const message = t('common.loading')
await changeLanguage('zh-CN')
```

### å‘åå…¼å®¹çš„ç®€åŒ–å¯¼å…¥

```typescript
// è¿™äº›å¯¼å…¥æ–¹å¼ä»ç„¶å¯ç”¨ï¼Œé»˜è®¤ä½¿ç”¨ vanilla ç‰ˆæœ¬
import { t, getCurrentLanguage, isZhCN } from '@sdppp/common'
```

## è¯­è¨€æ£€æµ‹æœºåˆ¶

ç³»ç»Ÿé‡‡ç”¨ç»Ÿä¸€çš„è¯­è¨€æ£€æµ‹é€»è¾‘ï¼ŒæŒ‰ä¼˜å…ˆçº§é¡ºåºï¼š

1. **æµè§ˆå™¨ç¯å¢ƒ**ï¼šæ£€æµ‹ `navigator.language`
2. **UXP ç¯å¢ƒ**ï¼šæ£€æµ‹ `require('uxp').host.uiLocale`
3. **é»˜è®¤å€¼**ï¼šè‹±æ–‡ (`en-US`)

```typescript
// è‡ªåŠ¨é‡æ–°æ£€æµ‹è¯­è¨€ï¼ˆä»… vanilla ç‰ˆæœ¬æ”¯æŒï¼‰
import { redetectLanguage } from '@sdppp/common/i18n/vanilla'
redetectLanguage()
```

## ç¿»è¯‘èµ„æºç»“æ„

### å½“å‰æ”¯æŒçš„ç¿»è¯‘é”®

#### è®¤è¯ç›¸å…³
- `auth.login_success` - ç™»å½•æˆåŠŸ
- `auth.username_label` - ç”¨æˆ·åæ ‡ç­¾ï¼ˆæ”¯æŒå‚æ•° `{username}`ï¼‰
- `auth.email_label` - é‚®ç®±æ ‡ç­¾ï¼ˆæ”¯æŒå‚æ•° `{email}`ï¼‰
- `auth.logout` - é€€å‡ºç™»å½•
- `auth.login_required` - ç™»å½•æç¤º

#### å›¾åƒå¤„ç†ç›¸å…³
- `image.send.select_position` - é€‰æ‹©å‘é€ä½ç½®
- `image.send.sending` - å‘é€ä¸­çŠ¶æ€
- `image.layer.new` - æ–°å›¾å±‚
- `image.layer.current` - å½“å‰å›¾å±‚
- `image.layer.fit_to_*` - é€‚é…é€‰é¡¹
- `image.get.*` - å›¾åƒè·å–é€‰é¡¹
- `image.crop.*` - è£å‰ªé€‰é¡¹
- `image.shortcut_*` - å¿«æ·é”®æç¤º

#### è’™ç‰ˆç›¸å…³
- `mask.get.select_mask` - é€‰æ‹©è’™ç‰ˆ
- `mask.selection` - é€‰åŒº
- `mask.*_exclude` - æ’é™¤é€‰é¡¹

#### é€šç”¨æ–‡æ¡ˆ
- `common.close` - å…³é—­
- `common.cancel` - å–æ¶ˆ
- `common.confirm` - ç¡®è®¤
- `common.loading` - åŠ è½½ä¸­
- `common.options` - é€‰é¡¹

### æ·»åŠ æ–°çš„ç¿»è¯‘

1. åœ¨ `locales/zh-CN.ts` ä¸­æ·»åŠ ä¸­æ–‡ç¿»è¯‘
2. åœ¨ `locales/en-US.ts` ä¸­æ·»åŠ å¯¹åº”çš„è‹±æ–‡ç¿»è¯‘
3. ç¡®ä¿é”®åä¸€è‡´ï¼ŒTypeScript ä¼šè‡ªåŠ¨æä¾›ç±»å‹æ£€æŸ¥

```typescript
// locales/zh-CN.ts
export const zhCN = {
  // ç°æœ‰ç¿»è¯‘...
  'feature.new_function': 'æ–°åŠŸèƒ½: {{name}}',
} as const

// locales/en-US.ts  
export const enUS = {
  // ç°æœ‰ç¿»è¯‘...
  'feature.new_function': 'New Feature: {{name}}',
} as const
```

## å‚æ•°æ›¿æ¢

æ”¯æŒ `{{paramName}}` æ ¼å¼çš„å‚æ•°æ›¿æ¢ï¼š

```typescript
// ç¿»è¯‘èµ„æºä¸­
'welcome.message': 'Welcome {{username}}, you have {{count}} messages'

// ä½¿ç”¨æ—¶
t('welcome.message', { username: 'John', count: 5 })
// è¾“å‡º: "Welcome John, you have 5 messages"
```

## ç±»å‹å®‰å…¨

æ‰€æœ‰ç¿»è¯‘é”®éƒ½æœ‰å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒï¼š

```typescript
import type { TranslationKey } from '@sdppp/common/i18n/locales'

// TranslationKey è”åˆç±»å‹åŒ…å«æ‰€æœ‰æœ‰æ•ˆçš„ç¿»è¯‘é”®
const key: TranslationKey = 'auth.login_success'  // âœ“ æœ‰æ•ˆ
const invalid: TranslationKey = 'invalid.key'      // âœ— ç±»å‹é”™è¯¯
```

## ä¾èµ–å…³ç³»

- **Vanilla ç‰ˆæœ¬**ï¼šæ— å¤–éƒ¨ä¾èµ–ï¼Œçº¯ TypeScript å®ç°
- **React ç‰ˆæœ¬**ï¼šä¾èµ– `i18next` å’Œ `react-i18next`
- **å…±äº«ä¾èµ–**ï¼š`@types/node`ï¼ˆä»…å¼€å‘æ—¶ï¼‰

## è¿ç§»æŒ‡å—

### ä»æ—§ç‰ˆæœ¬è¿ç§»

1. **æ›´æ–°å¯¼å…¥è·¯å¾„**ï¼š
   ```typescript
   // æ—§ç‰ˆæœ¬
   import { tUXP } from '@sdppp/common/i18n_uxp'
   import { t } from '@sdppp/common/i18n_next'
   
   // æ–°ç‰ˆæœ¬
   import { t } from '@sdppp/common/i18n/vanilla'  // ç”¨äºé React ç¯å¢ƒ
   import { useTranslation } from '@sdppp/common/i18n/react'  // ç”¨äº React ç»„ä»¶
   ```

2. **å‚æ•°æ ¼å¼å˜æ›´**ï¼š
   ```typescript
   // æ—§ç‰ˆæœ¬ä½¿ç”¨ {paramName}
   t('message', { name: 'John' })  // "Hello {name}" 
   
   // æ–°ç‰ˆæœ¬ä½¿ç”¨ {{paramName}}
   t('message', { name: 'John' })  // "Hello {{name}}"
   ```

3. **React ç»„ä»¶æ›´æ–°**ï¼š
   ```typescript
   // æ—§ç‰ˆæœ¬
   import { t } from '@sdppp/common/i18n_utils'
   
   function Component() {
     return <div>{t('key')}</div>
   }
   
   // æ–°ç‰ˆæœ¬
   import { useTranslation } from '@sdppp/common/i18n/react'
   
   function Component() {
     const { t } = useTranslation()
     return <div>{t('key')}</div>
   }
   ```

## æœ€ä½³å®è·µ

1. **é€‰æ‹©åˆé€‚çš„ API**ï¼š
   - UXP æ’ä»¶ã€å·¥å…·å‡½æ•°ï¼šä½¿ç”¨ `@sdppp/common/i18n/vanilla`
   - React ç»„ä»¶ï¼šä½¿ç”¨ `@sdppp/common/i18n/react`

2. **ç¿»è¯‘é”®å‘½åè§„èŒƒ**ï¼š
   - ä½¿ç”¨ç‚¹åˆ†éš”çš„å±‚çº§ç»“æ„ï¼š`module.feature.action`
   - ä¿æŒé”®åç®€æ´æ˜äº†ï¼š`auth.login` è€Œä¸æ˜¯ `authentication.user_login_action`

3. **å‚æ•°ä½¿ç”¨**ï¼š
   - ä¼˜å…ˆä½¿ç”¨å‚æ•°æ›¿æ¢è€Œä¸æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥
   - å‚æ•°åä½¿ç”¨ camelCaseï¼š`{{userName}}` è€Œä¸æ˜¯ `{{user_name}}`

4. **ç±»å‹å®‰å…¨**ï¼š
   - å§‹ç»ˆå¯¼å…¥ `TranslationKey` ç±»å‹ä»¥è·å¾—ç±»å‹æ£€æŸ¥
   - é¿å…ä½¿ç”¨å­—ç¬¦ä¸²å­—é¢é‡ï¼Œè®© TypeScript è‡ªåŠ¨æ¨æ–­

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç¿»è¯‘ä¸ç”Ÿæ•ˆ**ï¼š
   - æ£€æŸ¥ç¿»è¯‘é”®æ˜¯å¦åœ¨ä¸¤ä¸ªè¯­è¨€æ–‡ä»¶ä¸­éƒ½å­˜åœ¨
   - ç¡®è®¤å‚æ•°åç§°æ˜¯å¦æ­£ç¡®åŒ¹é…

2. **ç±»å‹é”™è¯¯**ï¼š
   - ç¡®ä¿ä½¿ç”¨çš„ç¿»è¯‘é”®å­˜åœ¨äºç±»å‹å®šä¹‰ä¸­
   - é‡æ–°æ„å»ºé¡¹ç›®ä»¥æ›´æ–°ç±»å‹ç¼“å­˜

3. **è¯­è¨€æ£€æµ‹ä¸å‡†ç¡®**ï¼š
   - åœ¨ UXP ç¯å¢ƒä¸­æ‰‹åŠ¨è°ƒç”¨ `redetectLanguage()`
   - æ£€æŸ¥ç³»ç»Ÿè¯­è¨€è®¾ç½®

### è°ƒè¯•æŠ€å·§

```typescript
// è·å–å½“å‰æ‰€æœ‰ç¿»è¯‘èµ„æºï¼ˆä»… vanilla ç‰ˆæœ¬ï¼‰
import { getCurrentLanguage } from '@sdppp/common/i18n/vanilla'
console.log('Current language:', getCurrentLanguage())

// æ£€æŸ¥ç‰¹å®šé”®æ˜¯å¦å­˜åœ¨
const result = t('test.key')
if (result === 'test.key') {
  console.warn('Translation key not found:', 'test.key')
}
```

## æ›´æ–°æ—¥å¿—

### 2024-08-31 - v2.0.0 (é‡æ„ç‰ˆæœ¬)
- ğŸ”„ å®Œå…¨é‡æ„æ¶æ„ï¼ŒæŒ‰æŠ€æœ¯æ ˆåˆ†å±‚
- ğŸ”§ ç»Ÿä¸€ç¿»è¯‘èµ„æºæ ¼å¼ï¼ˆå…¨éƒ¨è¿ç§»åˆ° TypeScriptï¼‰
- âœ¨ æ–°å¢å®Œæ•´çš„ç±»å‹å®‰å…¨æ”¯æŒ
- ğŸ—‘ï¸ ç§»é™¤æ—§ç‰ˆæœ¬æ–‡ä»¶ï¼ˆ`i18n_*.ts`ï¼‰
- ğŸ“š æ–°å¢ React Hook æ”¯æŒ
- ğŸŒ å®Œå–„è¯­è¨€æ£€æµ‹é€»è¾‘
- ğŸ“ æ–°å¢å®Œæ•´çš„ PS-UXP ç•Œé¢æ–‡æ¡ˆå›½é™…åŒ–

### å†å²ç‰ˆæœ¬
- v1.x - åŸºäºå¤šæ–‡ä»¶çš„åˆ†æ•£å¼æ¶æ„
- æ”¯æŒ JSON å’Œ TypeScript æ··åˆèµ„æºæ ¼å¼
- æŒ‰è¿è¡Œç¯å¢ƒåŒºåˆ† API